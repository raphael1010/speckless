/*
 * Fuel UX Wizard
 * https://github.com/ExactTarget/fuelux
 *
 * Copyright (c) 2012 ExactTarget
 * Licensed under the MIT license.
 */
var Wizard=function(t,e){var i;this.$element=$(t),this.options=$.extend({},$.fn.wizard.defaults,e),this.currentStep=this.options.selectedItem.step,this.numSteps=this.$element.find(".steps li").length,this.$prevBtn=this.$element.find("button.btn-prev"),this.$nextBtn=this.$element.find("button.btn-next"),i=this.$nextBtn.children().detach(),this.nextText=$.trim(this.$nextBtn.text()),this.$nextBtn.append(i),this.$prevBtn.on("click",$.proxy(this.previous,this)),this.$nextBtn.on("click",$.proxy(this.next,this)),this.$element.on("click","li.complete",$.proxy(this.stepclicked,this)),this.currentStep>1&&this.selectedItem(this.options.selectedItem)};Wizard.prototype={constructor:Wizard,setState:function(){var t=this.currentStep>1,e=1===this.currentStep,i=this.currentStep===this.numSteps;this.$prevBtn.attr("disabled",e===!0||t===!1);var n=this.$nextBtn.data();if(n&&n.last&&(this.lastText=n.last,"undefined"!=typeof this.lastText)){var s=i!==!0?this.nextText:this.lastText,o=this.$nextBtn.children().detach();this.$nextBtn.text(s).append(o)}var r=this.$element.find(".steps li");r.removeClass("active").removeClass("complete"),r.find("span.badge").removeClass("badge-primary").removeClass("badge-success");var a=".steps li:lt("+(this.currentStep-1)+")",l=this.$element.find(a);l.addClass("complete"),l.find("span.badge").addClass("badge-success");var h=".steps li:eq("+(this.currentStep-1)+")",c=this.$element.find(h);c.addClass("active"),c.find("span.badge").addClass("badge-primary");var u=c.data().target;this.$element.find(".step-pane").removeClass("active"),$(u).addClass("active"),$(".wizard .steps").attr("style","margin-left: 0");var d=0;$(".wizard .steps > li").each(function(){d+=$(this).outerWidth()});var p=0;if(p=$(".wizard .actions").length?$(".wizard").width()-$(".wizard .actions").outerWidth():$(".wizard").width(),d>p){var f=d-p;$(".wizard .steps").attr("style","margin-left: -"+f+"px"),$(".wizard li.active").position().left<200&&(f+=$(".wizard li.active").position().left-200,1>f?$(".wizard .steps").attr("style","margin-left: 0"):$(".wizard .steps").attr("style","margin-left: -"+f+"px"))}this.$element.trigger("changed")},stepclicked:function(t){var e=$(t.currentTarget),i=this.$element.find(".steps li").index(e),n=$.Event("stepclick");this.$element.trigger(n,{step:i+1}),n.isDefaultPrevented()||(this.currentStep=i+1,this.setState())},previous:function(){var t=this.currentStep>1;if(t){var e=$.Event("change");if(this.$element.trigger(e,{step:this.currentStep,direction:"previous"}),e.isDefaultPrevented())return;this.currentStep-=1,this.setState()}},next:function(){var t=this.currentStep+1<=this.numSteps,e=this.currentStep===this.numSteps;if(t){var i=$.Event("change");if(this.$element.trigger(i,{step:this.currentStep,direction:"next"}),i.isDefaultPrevented())return;this.currentStep+=1,this.setState()}else e&&this.$element.trigger("finished")},selectedItem:function(t){var e,i;return t?(i=t.step||-1,i>=1&&i<=this.numSteps&&(this.currentStep=i,this.setState()),e=this):e={step:this.currentStep},e}},$.fn.wizard=function(t,e){var i,n=this.each(function(){var n=$(this),s=n.data("wizard"),o="object"==typeof t&&t;s||n.data("wizard",s=new Wizard(this,o)),"string"==typeof t&&(i=s[t](e))});return void 0===i?n:i},$.fn.wizard.defaults={selectedItem:{step:1}},$.fn.wizard.Constructor=Wizard,$(function(){$("body").on("mousedown.wizard.data-api",".wizard",function(){var t=$(this);t.data("wizard")||t.wizard(t.data())})});