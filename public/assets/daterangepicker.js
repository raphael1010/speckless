/**
* @version: 1.2
* @author: Dan Grossman http://www.dangrossman.info/
* @date: 2013-07-25
* @copyright: Copyright (c) 2012-2013 Dan Grossman. All rights reserved.
* @license: Licensed under Apache License v2.0. See http://www.apache.org/licenses/LICENSE-2.0
* @website: http://www.improvely.com/
*/
!function(t){var e=function(e,i,n){var s,o="object"==typeof i;this.startDate=moment().startOf("day"),this.endDate=moment().startOf("day"),this.minDate=!1,this.maxDate=!1,this.dateLimit=!1,this.showDropdowns=!1,this.showWeekNumbers=!1,this.timePicker=!1,this.timePickerIncrement=30,this.timePicker12Hour=!0,this.ranges={},this.opens="right",this.buttonClasses=["btn","btn-small"],this.applyClass="btn-success",this.cancelClass="btn-default",this.format="MM/DD/YYYY",this.separator=" - ",this.locale={applyLabel:"Apply",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",weekLabel:"W",customRangeLabel:"Custom Range",daysOfWeek:moment()._lang._weekdaysMin.slice(),monthNames:moment()._lang._monthsShort.slice(),firstDay:0},this.cb=function(){},this.parentEl="body",this.element=t(e),this.element.hasClass("pull-right")&&(this.opens="left"),this.element.is("input")?this.element.on({click:t.proxy(this.show,this),focus:t.proxy(this.show,this)}):this.element.on("click",t.proxy(this.show,this)),s=this.locale,o&&("object"==typeof i.locale&&t.each(s,function(t,e){s[t]=i.locale[t]||e}),i.applyClass&&(this.applyClass=i.applyClass),i.cancelClass&&(this.cancelClass=i.cancelClass));var a='<div class="daterangepicker dropdown-menu"><div class="calendar left"></div><div class="calendar right"></div><div class="ranges"><div class="range_inputs"><div class="daterangepicker_start_input" style="float: left"><label for="daterangepicker_start">'+this.locale.fromLabel+'</label><input class="input-mini" type="text" name="daterangepicker_start" value="" disabled="disabled" /></div><div class="daterangepicker_end_input" style="float: left; padding-left: 11px"><label for="daterangepicker_end">'+this.locale.toLabel+'</label><input class="input-mini" type="text" name="daterangepicker_end" value="" disabled="disabled" /></div><button class="'+this.applyClass+' applyBtn" disabled="disabled">'+this.locale.applyLabel+'</button>&nbsp;<button class="'+this.cancelClass+' cancelBtn">'+this.locale.cancelLabel+"</button></div></div></div>";if(this.parentEl=o&&i.parentEl&&t(i.parentEl)||t(this.parentEl),this.container=t(a).appendTo(this.parentEl),o){if("string"==typeof i.format&&(this.format=i.format),"string"==typeof i.separator&&(this.separator=i.separator),"string"==typeof i.startDate&&(this.startDate=moment(i.startDate,this.format)),"string"==typeof i.endDate&&(this.endDate=moment(i.endDate,this.format)),"string"==typeof i.minDate&&(this.minDate=moment(i.minDate,this.format)),"string"==typeof i.maxDate&&(this.maxDate=moment(i.maxDate,this.format)),"object"==typeof i.startDate&&(this.startDate=moment(i.startDate)),"object"==typeof i.endDate&&(this.endDate=moment(i.endDate)),"object"==typeof i.minDate&&(this.minDate=moment(i.minDate)),"object"==typeof i.maxDate&&(this.maxDate=moment(i.maxDate)),"object"==typeof i.ranges){for(var r in i.ranges){var l=moment(i.ranges[r][0]),h=moment(i.ranges[r][1]);this.minDate&&l.isBefore(this.minDate)&&(l=moment(this.minDate)),this.maxDate&&h.isAfter(this.maxDate)&&(h=moment(this.maxDate)),this.minDate&&h.isBefore(this.minDate)||this.maxDate&&l.isAfter(this.maxDate)||(this.ranges[r]=[l,h])}var d="<ul>";for(var r in this.ranges)d+="<li>"+r+"</li>";d+="<li>"+this.locale.customRangeLabel+"</li>",d+="</ul>",this.container.find(".ranges").prepend(d)}if("object"==typeof i.dateLimit&&(this.dateLimit=i.dateLimit),"object"==typeof i.locale&&"number"==typeof i.locale.firstDay){this.locale.firstDay=i.locale.firstDay;for(var c=i.locale.firstDay;c>0;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),c--}"string"==typeof i.opens&&(this.opens=i.opens),"boolean"==typeof i.showWeekNumbers&&(this.showWeekNumbers=i.showWeekNumbers),"string"==typeof i.buttonClasses&&(this.buttonClasses=[i.buttonClasses]),"object"==typeof i.buttonClasses&&(this.buttonClasses=i.buttonClasses),"boolean"==typeof i.showDropdowns&&(this.showDropdowns=i.showDropdowns),"boolean"==typeof i.timePicker&&(this.timePicker=i.timePicker),"number"==typeof i.timePickerIncrement&&(this.timePickerIncrement=i.timePickerIncrement),"boolean"==typeof i.timePicker12Hour&&(this.timePicker12Hour=i.timePicker12Hour)}this.timePicker||(this.startDate=this.startDate.startOf("day"),this.endDate=this.endDate.startOf("day"));var u=this.container;if(t.each(this.buttonClasses,function(t,e){u.find("button").addClass(e)}),"right"==this.opens){var p=this.container.find(".calendar.left"),f=this.container.find(".calendar.right");p.removeClass("left").addClass("right"),f.removeClass("right").addClass("left")}if(("undefined"==typeof i||"undefined"==typeof i.ranges)&&(this.container.find(".calendar").show(),this.move()),"function"==typeof n&&(this.cb=n),this.container.addClass("opens"+this.opens),(!o||"undefined"==typeof i.startDate&&"undefined"==typeof i.endDate)&&t(this.element).is("input[type=text]")){var l,h,m=t(this.element).val(),g=m.split(this.separator);2==g.length&&(l=moment(g[0],this.format),h=moment(g[1],this.format)),null!=l&&null!=h&&(this.startDate=l,this.endDate=h)}this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.leftCalendar={month:moment([this.startDate.year(),this.startDate.month(),1,this.startDate.hour(),this.startDate.minute()]),calendar:[]},this.rightCalendar={month:moment([this.endDate.year(),this.endDate.month(),1,this.endDate.hour(),this.endDate.minute()]),calendar:[]},this.container.on("mousedown",t.proxy(this.mousedown,this)),this.container.find(".calendar").on("click",".prev",t.proxy(this.clickPrev,this)),this.container.find(".calendar").on("click",".next",t.proxy(this.clickNext,this)),this.container.find(".ranges").on("click","button.applyBtn",t.proxy(this.clickApply,this)),this.container.find(".ranges").on("click","button.cancelBtn",t.proxy(this.clickCancel,this)),this.container.find(".ranges").on("click",".daterangepicker_start_input",t.proxy(this.showCalendars,this)),this.container.find(".ranges").on("click",".daterangepicker_end_input",t.proxy(this.showCalendars,this)),this.container.find(".calendar").on("click","td.available",t.proxy(this.clickDate,this)),this.container.find(".calendar").on("mouseenter","td.available",t.proxy(this.enterDate,this)),this.container.find(".calendar").on("mouseleave","td.available",t.proxy(this.updateView,this)),this.container.find(".ranges").on("click","li",t.proxy(this.clickRange,this)),this.container.find(".ranges").on("mouseenter","li",t.proxy(this.enterRange,this)),this.container.find(".ranges").on("mouseleave","li",t.proxy(this.updateView,this)),this.container.find(".calendar").on("change","select.yearselect",t.proxy(this.updateMonthYear,this)),this.container.find(".calendar").on("change","select.monthselect",t.proxy(this.updateMonthYear,this)),this.container.find(".calendar").on("change","select.hourselect",t.proxy(this.updateTime,this)),this.container.find(".calendar").on("change","select.minuteselect",t.proxy(this.updateTime,this)),this.container.find(".calendar").on("change","select.ampmselect",t.proxy(this.updateTime,this)),this.element.on("keyup",t.proxy(this.updateFromControl,this)),this.updateView(),this.updateCalendars()};e.prototype={constructor:e,mousedown:function(t){t.stopPropagation()},updateView:function(){this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()),this.container.find("input[name=daterangepicker_start]").val(this.startDate.format(this.format)),this.container.find("input[name=daterangepicker_end]").val(this.endDate.format(this.format)),this.startDate.isSame(this.endDate)||this.startDate.isBefore(this.endDate)?this.container.find("button.applyBtn").removeAttr("disabled"):this.container.find("button.applyBtn").attr("disabled","disabled")},updateFromControl:function(){if(this.element.is("input")&&this.element.val().length){var t=this.element.val().split(this.separator),e=moment(t[0],this.format),i=moment(t[1],this.format);null!=e&&null!=i&&(i.isBefore(e)||(this.startDate=e,this.endDate=i,this.notify(),this.updateCalendars()))}},notify:function(){this.updateView(),this.cb(this.startDate,this.endDate)},move:function(){var e={top:this.parentEl.offset().top-(this.parentEl.is("body")?0:this.parentEl.scrollTop()),left:this.parentEl.offset().left-(this.parentEl.is("body")?0:this.parentEl.scrollLeft())};"left"==this.opens?(this.container.css({top:this.element.offset().top+this.element.outerHeight()-e.top,right:t(window).width()-this.element.offset().left-this.element.outerWidth()-e.left,left:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):(this.container.css({top:this.element.offset().top+this.element.outerHeight()-e.top,left:this.element.offset().left-e.left,right:"auto"}),this.container.offset().left+this.container.outerWidth()>t(window).width()&&this.container.css({left:"auto",right:0}))},show:function(e){this.container.show(),this.move(),e&&(e.stopPropagation(),e.preventDefault()),t(document).on("mousedown",t.proxy(this.hide,this)),this.element.trigger("shown",{target:e.target,picker:this})},hide:function(){this.container.hide(),this.startDate.isSame(this.oldStartDate)&&this.endDate.isSame(this.oldEndDate)||this.notify(),this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),t(document).off("mousedown",this.hide),this.element.trigger("hidden",{picker:this})},enterRange:function(t){var e=t.target.innerHTML;if(e==this.locale.customRangeLabel)this.updateView();else{var i=this.ranges[e];this.container.find("input[name=daterangepicker_start]").val(i[0].format(this.format)),this.container.find("input[name=daterangepicker_end]").val(i[1].format(this.format))}},showCalendars:function(){this.container.find(".calendar").show(),this.move()},updateInputText:function(){this.element.is("input")&&this.element.val(this.startDate.format(this.format)+this.separator+this.endDate.format(this.format))},clickRange:function(t){var e=t.target.innerHTML;if(e==this.locale.customRangeLabel)this.showCalendars();else{var i=this.ranges[e];this.startDate=i[0],this.endDate=i[1],this.timePicker||(this.startDate.startOf("day"),this.endDate.startOf("day")),this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()).hour(this.startDate.hour()).minute(this.startDate.minute()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()).hour(this.endDate.hour()).minute(this.endDate.minute()),this.updateCalendars(),this.updateInputText(),this.container.find(".calendar").hide(),this.hide()}},clickPrev:function(e){var i=t(e.target).parents(".calendar");i.hasClass("left")?this.leftCalendar.month.subtract("month",1):this.rightCalendar.month.subtract("month",1),this.updateCalendars()},clickNext:function(e){var i=t(e.target).parents(".calendar");i.hasClass("left")?this.leftCalendar.month.add("month",1):this.rightCalendar.month.add("month",1),this.updateCalendars()},enterDate:function(e){var i=t(e.target).attr("data-title"),n=i.substr(1,1),s=i.substr(3,1),o=t(e.target).parents(".calendar");o.hasClass("left")?this.container.find("input[name=daterangepicker_start]").val(this.leftCalendar.calendar[n][s].format(this.format)):this.container.find("input[name=daterangepicker_end]").val(this.rightCalendar.calendar[n][s].format(this.format))},clickDate:function(e){var i=t(e.target).attr("data-title"),n=i.substr(1,1),s=i.substr(3,1),o=t(e.target).parents(".calendar");if(o.hasClass("left")){var a=this.leftCalendar.calendar[n][s],r=this.endDate;if("object"==typeof this.dateLimit){var l=moment(a).add(this.dateLimit).startOf("day");r.isAfter(l)&&(r=l)}}else{var a=this.startDate,r=this.rightCalendar.calendar[n][s];if("object"==typeof this.dateLimit){var h=moment(r).subtract(this.dateLimit).startOf("day");a.isBefore(h)&&(a=h)}}o.find("td").removeClass("active"),a.isSame(r)||a.isBefore(r)?(t(e.target).addClass("active"),this.startDate=a,this.endDate=r):a.isAfter(r)&&(t(e.target).addClass("active"),this.startDate=a,this.endDate=moment(a).add("day",1).startOf("day")),this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()),this.updateCalendars()},clickApply:function(){this.updateInputText(),this.hide()},clickCancel:function(){this.startDate=this.oldStartDate,this.endDate=this.oldEndDate,this.updateView(),this.updateCalendars(),this.hide()},updateMonthYear:function(e){var i=t(e.target).closest(".calendar").hasClass("left"),n=this.container.find(".calendar.left");i||(n=this.container.find(".calendar.right"));var s=parseInt(n.find(".monthselect").val()),o=n.find(".yearselect").val();i?this.leftCalendar.month.month(s).year(o):this.rightCalendar.month.month(s).year(o),this.updateCalendars()},updateTime:function(e){var i=t(e.target).closest(".calendar").hasClass("left"),n=this.container.find(".calendar.left");i||(n=this.container.find(".calendar.right"));var s=parseInt(n.find(".hourselect").val()),o=parseInt(n.find(".minuteselect").val());if(this.timePicker12Hour){var a=n.find(".ampmselect").val();"PM"==a&&12>s&&(s+=12),"AM"==a&&12==s&&(s=0)}if(i){var r=this.startDate;r.hour(s),r.minute(o),this.startDate=r,this.leftCalendar.month.hour(s).minute(o)}else{var l=this.endDate;l.hour(s),l.minute(o),this.endDate=l,this.rightCalendar.month.hour(s).minute(o)}this.updateCalendars()},updateCalendars:function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.month(),this.leftCalendar.month.year(),this.leftCalendar.month.hour(),this.leftCalendar.month.minute(),"left"),this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.month(),this.rightCalendar.month.year(),this.rightCalendar.month.hour(),this.rightCalendar.month.minute(),"right"),this.container.find(".calendar.left").html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.maxDate)),this.container.find(".calendar.right").html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.startDate,this.maxDate)),this.container.find(".ranges li").removeClass("active");var t=!0,e=0;for(var i in this.ranges)this.timePicker?this.startDate.isSame(this.ranges[i][0])&&this.endDate.isSame(this.ranges[i][1])&&(t=!1,this.container.find(".ranges li:eq("+e+")").addClass("active")):this.startDate.format("YYYY-MM-DD")==this.ranges[i][0].format("YYYY-MM-DD")&&this.endDate.format("YYYY-MM-DD")==this.ranges[i][1].format("YYYY-MM-DD")&&(t=!1,this.container.find(".ranges li:eq("+e+")").addClass("active")),e++;t&&this.container.find(".ranges li:last").addClass("active")},buildCalendar:function(t,e,i,n){for(var s=moment([e,t,1]),o=moment(s).subtract("month",1).month(),a=moment(s).subtract("month",1).year(),r=moment([a,o]).daysInMonth(),l=s.day(),h=[],d=0;6>d;d++)h[d]=[];var c=r-l+this.locale.firstDay+1;c>r&&(c-=7),l==this.locale.firstDay&&(c=r-6);for(var u=moment([a,o,c,i,n]),d=0,p=0,f=0;42>d;d++,p++,u=moment(u).add("day",1))d>0&&p%7==0&&(p=0,f++),h[f][p]=u;return h},renderDropdowns:function(t,e,i){for(var n=t.month(),s='<select class="monthselect">',o=!1,a=!1,r=0;12>r;r++)(!o||r>=e.month())&&(!a||r<=i.month())&&(s+="<option value='"+r+"'"+(r===n?" selected='selected'":"")+">"+this.locale.monthNames[r]+"</option>");s+="</select>";for(var l=t.year(),h=i&&i.year()||l+5,d=e&&e.year()||l-50,c='<select class="yearselect">',u=d;h>=u;u++)c+='<option value="'+u+'"'+(u===l?' selected="selected"':"")+">"+u+"</option>";return c+="</select>",s+c},renderCalendar:function(e,i,n,s){var o='<div class="calendar-date">';o+='<table class="table-condensed">',o+="<thead>",o+="<tr>",this.showWeekNumbers&&(o+="<th></th>"),o+=!n||n.isBefore(e[1][1])?'<th class="prev available"><i class="icon-arrow-left glyphicon glyphicon-arrow-left"></i></th>':"<th></th>";var a=this.locale.monthNames[e[1][1].month()]+e[1][1].format(" YYYY");this.showDropdowns&&(a=this.renderDropdowns(e[1][1],n,s)),o+='<th colspan="5" style="width: auto">'+a+"</th>",o+=!s||s.isAfter(e[1][1])?'<th class="next available"><i class="icon-arrow-right glyphicon glyphicon-arrow-right"></i></th>':"<th></th>",o+="</tr>",o+="<tr>",this.showWeekNumbers&&(o+='<th class="week">'+this.locale.weekLabel+"</th>"),t.each(this.locale.daysOfWeek,function(t,e){o+="<th>"+e+"</th>"}),o+="</tr>",o+="</thead>",o+="<tbody>";for(var r=0;6>r;r++){o+="<tr>",this.showWeekNumbers&&(o+='<td class="week">'+e[r][0].week()+"</td>");for(var l=0;7>l;l++){var h="available ";h+=e[r][l].month()==e[1][1].month()?"":"off",n&&e[r][l].isBefore(n)||s&&e[r][l].isAfter(s)?h=" off disabled ":e[r][l].format("YYYY-MM-DD")==i.format("YYYY-MM-DD")?(h+=" active ",e[r][l].format("YYYY-MM-DD")==this.startDate.format("YYYY-MM-DD")&&(h+=" start-date "),e[r][l].format("YYYY-MM-DD")==this.endDate.format("YYYY-MM-DD")&&(h+=" end-date ")):e[r][l]>=this.startDate&&e[r][l]<=this.endDate&&(h+=" in-range ",e[r][l].isSame(this.startDate)&&(h+=" start-date "),e[r][l].isSame(this.endDate)&&(h+=" end-date "));var d="r"+r+"c"+l;o+='<td class="'+h.replace(/\s+/g," ").replace(/^\s?(.*?)\s?$/,"$1")+'" data-title="'+d+'">'+e[r][l].date()+"</td>"}o+="</tr>"}if(o+="</tbody>",o+="</table>",o+="</div>",this.timePicker){o+='<div class="calendar-time">',o+='<select class="hourselect">';var c=0,u=23,p=i.hour();this.timePicker12Hour&&(c=1,u=12,p>=12&&(p-=12),0==p&&(p=12));for(var f=c;u>=f;f++)o+=f==p?'<option value="'+f+'" selected="selected">'+f+"</option>":'<option value="'+f+'">'+f+"</option>";o+="</select> : ",o+='<select class="minuteselect">';for(var f=0;60>f;f+=this.timePickerIncrement){var m=f;10>m&&(m="0"+m),o+=f==i.minute()?'<option value="'+f+'" selected="selected">'+m+"</option>":'<option value="'+f+'">'+m+"</option>"}o+="</select> ",this.timePicker12Hour&&(o+='<select class="ampmselect">',o+=i.hour()>=12?'<option value="AM">AM</option><option value="PM" selected="selected">PM</option>':'<option value="AM" selected="selected">AM</option><option value="PM">PM</option>',o+="</select>"),o+="</div>"}return o}},t.fn.daterangepicker=function(i,n){return this.each(function(){var s=t(this);s.data("daterangepicker")||s.data("daterangepicker",new e(s,i,n))}),this}}(window.jQuery);